@if (showSplash()) {
<div class="splash-screen">
  <div class="splash-content">
    <img src="assets/icon/icon.png" class="splash-logo" alt="TEO Logo" />
    <h1>Tiempo Es Oro</h1>
    <p class="loading-text">Iniciando...</p>
  </div>
</div>
} @else {
<ion-header [translucent]="true">
  <ion-toolbar color="primary">
    <ion-buttons slot="start">
      <ion-menu-button></ion-menu-button>
    </ion-buttons>
    <ion-title>
      <div class="header-title-wrapper">
        <span class="app-name">TEO</span>
        <div class="header-date">
          <span>{{ selectedDateText() }}</span>
        </div>
      </div>
    </ion-title>
  </ion-toolbar>

  <!-- Tabs de Vista Principal (Agenda, Hoy, Semana, Mes) -->
  <ion-toolbar class="view-tabs-toolbar">
    <ion-segment [value]="vistaActual()" (ionChange)="onVistaChange($event)" mode="md" class="main-view-segment"
      scrollable="true">
      <ion-segment-button value="agenda">
        <ion-label>Agenda</ion-label>
      </ion-segment-button>
      <ion-segment-button value="dia">
        <ion-label>Hoy</ion-label>
      </ion-segment-button>
      <ion-segment-button value="semana">
        <ion-label>Semana</ion-label>
      </ion-segment-button>
      <ion-segment-button value="mes">
        <ion-label>Mes</ion-label>
      </ion-segment-button>
      <ion-segment-button value="stats">
        <ion-label>Información</ion-label>
      </ion-segment-button>
    </ion-segment>
  </ion-toolbar>

  <!-- Search and Filters Toolbar -->
  <ion-toolbar class="search-toolbar">
    <div class="search-filters-container">
      <div class="search-wrapper">
        <app-agenda-search (resultSelected)="onSearchResultSelected($event)"></app-agenda-search>
      </div>
      <ion-buttons slot="end">
        <ion-button (click)="toggleFilters()" [color]="showFilters() ? 'primary' : 'medium'">
          <ion-icon slot="icon-only" name="funnel"></ion-icon>
        </ion-button>
      </ion-buttons>
    </div>
  </ion-toolbar>

  <!-- Filters Panel (Collapsible) -->
  @if (showFilters()) {
  <div class="filters-panel">
    <app-agenda-filters (filtersChanged)="applyFilters($event)"></app-agenda-filters>
  </div>
  }
</ion-header>

<ion-content>
  <!-- FAB Add Button (Relocated to Top Right) -->
  <ion-fab vertical="top" horizontal="end" slot="fixed" class="fab-top-right">
    <ion-fab-button (click)="openFabOptions()" color="success">
      <ion-icon name="add"></ion-icon>
    </ion-fab-button>
  </ion-fab>

  <div class="agenda-container">

    <!-- VISTA AGENDA -->
    @if (vistaActual() === 'agenda') {
    <div class="vista-agenda">
      <!-- Si no hay registros próximos -->
      @if (registrosFiltrados().length === 0) {
      <div class="empty-state">
        <ion-icon name="time-outline" size="large" color="success"></ion-icon>
        <h2>¡Todo en orden!</h2>
        <p>No tienes tareas pendientes para las próximas horas.</p>
      </div>
      } @else {
      <div class="registros-list">
        <!-- Table Header -->
        <ion-grid class="agenda-table">
          <ion-row class="header-row">
            <ion-col size="3">Evento</ion-col>
            <ion-col size="3">Área</ion-col>
            <ion-col size="2">Hora</ion-col>
            <ion-col size="2">Duración</ion-col>
            <ion-col size="2">Faltante</ion-col>
          </ion-row>

          @for (registro of registrosFiltrados(); track registro.id) {
          <ion-row class="data-row" (click)="editarRegistro(registro)">
            <ion-col size="3" class="col-name text-truncate">{{ registro.name }}</ion-col>
            <ion-col size="3" class="text-truncate">{{ getAreaName(registro) }}</ion-col>
            <ion-col size="2">
              <div class="time-stack">
                <span>{{ formatDateWithTime(registro.startTime) }}</span>
                <span class="end-time">{{ formatDateWithTime(registro.endTime) }}</span>
              </div>
            </ion-col>
            <ion-col size="2">{{ getDuration(registro) }} min</ion-col>
            <ion-col size="2" class="col-remaining">
              <ion-badge color="primary" mode="ios">{{ getTimeRemaining(registro) }}</ion-badge>
            </ion-col>
          </ion-row>
          }
        </ion-grid>
      </div>
      }
    </div>
    }

    <!-- VISTA HOY -->
    @if (vistaActual() === 'dia') {
    <div class="vista-dia">
      <app-day-view [registros]="registrosFiltrados()" [currentDate]="currentDate()"></app-day-view>
    </div>
    }

    <!-- VISTA SEMANA -->
    @if (vistaActual() === 'semana') {
    <div class="vista-semana">
      <app-week-view [registros]="registrosFiltrados()" (daySelected)="openDayDrawer($event)"></app-week-view>
    </div>
    }

    <!-- VISTA MES -->
    @if (vistaActual() === 'mes') {
    <div class="vista-mes">
      <app-month-view [registros]="registrosFiltrados()" [currentDate]="selectedDate()"
        (daySelected)="openDayDrawer($event)"></app-month-view>
    </div>
    }

    <!-- VISTA ESTADOS (Placeholder por ahora si existiera) -->
    @if (vistaActual() === 'estados') {
    <div class="empty-state">
      <ion-icon name="construct-outline" size="large" color="medium"></ion-icon>
      <h2>Estados</h2>
      <p>Vista de estados en construcción.</p>
    </div>
    }

    <!-- VISTA ESTADÍSTICAS -->
    @if (vistaActual() === 'stats') {
    <app-reports></app-reports>
    }

  </div>
</ion-content>
}