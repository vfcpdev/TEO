@if (showSplash()) {
<div class="splash-screen">
  <div class="splash-content">
    <img src="assets/icon/icon.png" class="splash-logo" alt="TEO Logo" />
    <h1>Tiempo Es Oro</h1>
    <p class="loading-text">Iniciando...</p>
  </div>
</div>
} @else {
<ion-header [translucent]="true">
  <ion-toolbar color="primary">
    <ion-buttons slot="start">
      <ion-menu-button></ion-menu-button>
    </ion-buttons>
    <ion-title>
      <div class="header-title-wrapper">
        <span class="app-name">TEO</span>
        <div class="header-date">
          <span>{{ selectedDateText() }}</span>
        </div>
      </div>
    </ion-title>
  </ion-toolbar>

  <!-- Tabs de Vista Principal (Agenda, Hoy, Semana, Mes) -->
  <ion-toolbar class="view-tabs-toolbar">
    <ion-segment [value]="vistaActual()" (ionChange)="onVistaChange($event)" mode="md" class="main-view-segment"
      scrollable="true">
      <ion-segment-button value="agenda">
        <ion-label>Agenda</ion-label>
      </ion-segment-button>
      <ion-segment-button value="dia">
        <ion-label>Hoy</ion-label>
      </ion-segment-button>
      <ion-segment-button value="semana">
        <ion-label>Semana</ion-label>
      </ion-segment-button>
      <ion-segment-button value="mes">
        <ion-label>Mes</ion-label>
      </ion-segment-button>
    </ion-segment>
  </ion-toolbar>
</ion-header>

<ion-content>
  <!-- FAB Add Button (Relocated to Top Right) -->
  <ion-fab vertical="top" horizontal="end" slot="fixed" class="fab-top-right">
    <ion-fab-button (click)="openRegistroWizard()" color="success">
      <ion-icon name="add"></ion-icon>
    </ion-fab-button>
  </ion-fab>

  <div class="agenda-container">

    <!-- VISTA AGENDA -->
    @if (vistaActual() === 'agenda') {
    <div class="vista-agenda">
      <!-- Si no hay registros próximos -->
      @if (registrosFiltrados().length === 0) {
      <div class="empty-state">
        <ion-icon name="time-outline" size="large" color="success"></ion-icon>
        <h2>¡Todo en orden!</h2>
        <p>No tienes tareas pendientes para las próximas horas.</p>
      </div>
      } @else {
      <div class="registros-list">
        @for (registro of registrosFiltrados(); track registro.id) {
        <!-- Buffer Visualizer BEFORE -->
        @if (registro.bufferBefore?.duration) {
        <app-buffer-visualizer type="before" [buffer]="registro.bufferBefore"
          [pixelsPerMinute]="1"></app-buffer-visualizer>
        }

        <div class="registro-card" (click)="editarRegistro(registro)">
          <div class="registro-info">
            <h3>{{ registro.name }}</h3>
            <p>{{ formatDateWithTime(registro.startTime) }} - {{ formatDateWithTime(registro.endTime) }}</p>
          </div>
          <ion-icon slot="end" name="chevron-forward-outline" color="medium"></ion-icon>
        </div>

        <!-- Buffer Visualizer AFTER -->
        @if (registro.bufferAfter?.duration) {
        <app-buffer-visualizer type="after" [buffer]="registro.bufferAfter"
          [pixelsPerMinute]="1"></app-buffer-visualizer>
        }
        }
      </div>
      }
    </div>
    }

    <!-- VISTA HOY -->
    @if (vistaActual() === 'dia') {
    <div class="vista-dia">
      <app-day-view [registros]="registrosFiltrados()" [currentDate]="currentDate()"></app-day-view>
    </div>
    }

    <!-- VISTA SEMANA -->
    @if (vistaActual() === 'semana') {
    <div class="vista-semana">
      <app-week-view [registros]="registrosFiltrados()"></app-week-view>
    </div>
    }

    <!-- VISTA MES -->
    @if (vistaActual() === 'mes') {
    <div class="vista-mes">
      <app-month-view [registros]="registrosFiltrados()" [currentDate]="selectedDate()"></app-month-view>
    </div>
    }

    <!-- VISTA ESTADOS (Placeholder por ahora si existiera) -->
    @if (vistaActual() === 'estados') {
    <div class="empty-state">
      <ion-icon name="construct-outline" size="large" color="medium"></ion-icon>
      <h2>Estados</h2>
      <p>Vista de estados en construcción.</p>
    </div>
    }

  </div>
</ion-content>
}